name: Deploy to Linux VM

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    # OLD: runs-on: ubuntu-latest
    # NEW: Use your self-hosted runner
    runs-on: self-hosted
    
    # OR target specific labels:
    # runs-on: [self-hosted, linux, deploy]
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          
      - run: npm ci
      - run: npm run build
      
      - name: Docker Build & Push
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: yourusername/your-image:latest
      
      - name: Deploy on Linux VM
        run: |
          echo "Running directly on Linux VM!"
          cd /var/www/sinu-island-gateway
          git pull origin main
          docker-compose up -d --build
          echo "âœ… Deployment complete!"